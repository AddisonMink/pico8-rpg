pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include util.lua
#include menu.lua
#include menu_tree.lua
#include global_state.lua
#include dialogue.lua
#include world.lua

function _init()
  world = world_new()
  state = "world"
end

function _update()
  if state == "world" then
    local code, result = world:update()
    if code == "dialogue" then
      dialogue = result
      state = "dialogue"
    end
  elseif state == "dialogue" then
    local done = dialogue:update()
    if done then
      state = "world"
    end
  end
end

function _draw()
  local camera_x = peek2(0x5f28)
  local camera_y = peek2(0x5f2a)

  cls()
  if state == "world" then
    world:draw()
  elseif state == "dialogue" then
    dialogue:draw()
  end

  rectfill(camera_x, camera_y, camera_x + 128, camera_y + 8, 0)
  print("$" .. global.coins, camera_x + 2, camera_y + 2, 7)
end

__gfx__
000000000060000000000000000000000000000000000000000bb000000bb000000bb0000000070000000000000000000000000011118111f777ffff2222d222
0000000007777700000000000000000000000efff000000000833300008333000083330000500b00000000000000bbb0000b7000111121ccfffffcc72d222622
007007007777000000000000000000000000fefff000000000bbbb0000bbbb0000bbbb000050bb700000000000000000000bb000c118821111cccccc22226662
000770007776000000000000000bb0880000eeffff00000000eeee0000eeee0000eeee000555bb7000000000bb00000000bbb700118258811111111122222622
0007700000000000070000033333b8000000b33ffb00000000beeb0000beeb0000beeb0005553bb00004444400000000003bbb00112515211111c11126662622
0070070000000000007000003eee33000000bb333bbf4400002b3200004b3000000b34005553bbb700044644000000000bbb33b0111616111111111126562222
0000000000000000000700000ffef330000bb32222fff440000330000023300000033200555b33bb00447774000bbb0003bbb3b01c16561111111111265622dd
0000000000000000000070060fffee0004fff244444444400040040000400400004004000020020004047644000000000b33bbb0c1c6661111c1111126662222
000bb000000bb00000000760b3333e000444444a44a44200000bb000000bb000000bb000002828888004777400000000bbb33bbb006161601111111122222222
033bb800033bb80000000642bbbbf4400024444a9442220000033800000338000003380002888228284446740b70000000024000006666601111c1112222ddd2
00e3330000e3330000006004244334400022224442222200003ee300003ee300003ee3000822888888047774bbb700b00004240000055500111c1cc122222222
00ffee0000ffee0000000000033b3000002222222222220000effe0000effe0000effe008222828222844644bbbb00b000422400002222201c111111dd222222
00b33e0000b33e0000000000fb44b300002222222222220000bbbb0000bbb400004bbb0027177477172444440bbb05bb02556640088258281111111122222222
00b4300000bb40000000000fffbb33f00022222222222000004b3400002b3000000b320004454444440000000040055b25521662006656501111111122222222
000bb000000bb0000000000ff03b0ff000002222222000000003300000433000000334000551565656000000040000402521114600551560cc11111c222ddd22
0040400000040000000000444000044000000002200000000040040000400400004004000651556565000000044000002521112600651560111cc11122222222
0220002000002002020002202222622200d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002202020022020020220002226662200d000000000d00000000000000000000b00000000000000000000000000000000000000000000000000000000000000
2022222220222d2222222202222d6d2200d000000000d000000000000000000000b0000b00000000000000000000000000000000000000000000000000000000
022d2dd2222222222dd2222022d565d20d5d00000000d0000000044444444444000000b000000000000000000000000000000000000000000000000000000000
22222222d222222222222d222d56165dd565d000000d5d000000047444444444000b00b000000000000000000000000000000000000000000000000000000000
02222222222d222222222220226111620616000000d565d00000047477747774000b000000000000000000000000000000000000000000000000000000000000
00222d222222222222d2220022611162066660000006160000000474747474740b0b000000000000000000000000000000000000000000000000000000000000
002d2222dd222dd2d2222200222666220056662d2265656000000444444444440b00000000000000000000000000000000000000000000000000000000000000
02222222222222202222262d00288800000562ddd266666000000040028888000000000000000000000000000000000000000000000000000000000000000000
00222dd222222200262266620288828000060dd5dd55550008228228288828800000000000000000000000000000000000000000000000000000000000000000
2022222222dd220265626562082288800006dd565dd565602282222282288888a1aa1aa100000000000000000000000000000000000000000000000000000000
0222222222222220656265628222222800ddd56565ddddd006666666822222881aa1aa1a00000000000000000000000000000000000000000000000000000000
222dd2222222222266626562271771720d556651565656dd0661661627177178aa1aa1aa00000000000000000000000000000000000000000000000000000000
022222222222dd202222656204464440006556111651616005556555544644400400004000000000000000000000000000000000000000000000000000000000
00222222222222002dd2666207616470006565111551616005655556566156602040020400000000000000000000000000000000000000000000000000000000
222222ddd22222222222666206616660005556111656565000000000056165602040020400000000000000000000000000000000000000000000000000000000
0000000000000000c5cc7ccc5ccccc5c000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000555bb7cc5ccbcc5c066600000706600000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555bbc555cbc555777660000077660000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000353bbb5555bb7555077769900077769900000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000033b55b73535bb555007799f00007799f00000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000053bbbb5333bb53530000b30000000b3000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003b55bbb5535bb335000b30f00000b30f00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbbb5bb55b7330ff0f000000f060000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000555b5b555bbbbb57000f006600f00f0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000053334533bbbb5bb3000000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000033534333555bbbb3000007776990000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333433bbbb5bb5b0007777799f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000333343b33334333300000000b300000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000033533333b33433b30000000b30f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333b333333433330000000f6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000b333333b3b333b330000000f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000b000030
00000000000000000000000000000000000000000000cc000000003000000000000000000000000000000000000000000000000000000000000000000eb00320
000000000000000000000000000000000000000000000cc0000000300000000000000000000000000000000000000000000000000000000000b000000eebbb30
000000000000000000000000000000000000000000000ccc0000003000000000000000000000000000000000000000000000000000000000000b0000bbeb8b80
00000000000000000000000000000000000000000000cc444000030000000000000000000000000000000000000000000000000000000000000b00003ebbbbbb
0000000000000000000000000000000000000000000044ccccc0030000000000000000000000000000000000000000000000000000000000003b000bb333b7e7
000000000000000000000000000000000000000000ccccee000003000000000000000000000000000000000000000000000000000000000003b0000b3ee00bb0
00000000000000000000000000000000000000000000077670000300000000000000000000000000000000000000000000000000000000000bb000bbef000000
00000000000000000666000000000000000000000000cc777c0cf000000000000000000000000000000000000000000000000000000000000bb000bbfef30000
0000000000000000777669900000000000000000000ccc777cccf000000000000000000000000000000000000000000000000000000000000bbbb00bbfe30000
0000000000000000077799f0000000000000000000fcc5777ccc30000000000000000000000000000000000000000000000000000000000000bbbbbbbef30000
00000000000000000000b300000000000000000000fc44c7000c3000000000000000000000000000000000000000000000000000000000000bb33bbb3feb0000
0000000000000000000b30f00000000000000000000c5ccc4003000000000000000000000000000000000000000000000000000000000000bb00bbb3eebb0000
000000000000000000f0600000000000000000000005ccc54c03000000000000000000000000000000000000000000000000000000000000b00bb003303bb000
00000000000000000f00f0000000000000000000000ccc555c03000000000000000000000000000000000000000000000000000000000000bb0bb00000033b00
00000000000000000000000000000000000000000004440044430000000000000000000000000000000000000000000000000000000000000b707b70000007b7
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777700000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007007077070
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070007777770
00000000000bb0880000000000bb088000000000000000bb0880000000000000000000bb08800000000000000000000000000000000000000000777707777770
070000033333b80000000033333b8000000000000033333b80000000000000000033333b80000000000000000000000000000000000000000777000007777770
007000003eee330000000003eee33000000000000003eee330000000000000000003eee330000000000000000000000000000000000000000070000000777700
000700000ffef33000000000ffef3300000000007777777f33000000000000000000ffef33000000000000000000000000000000000000000777000000077000
000070060fffee0000000000ff6ee400077777777777fffee0000000000000060000fffee0000000000000000000000000000000000000000000000000000000
00000760b3333e000000000b3363e400000000060000b3333e000000000000060000b3333e000000000000000000000000000000000000000000000000000000
00000642bbbbf44000077777776440007777777644f3bbbbf44000007777777644f3bbbbf4400000000000000000000000000000000000000700007007777700
000060042443344000000000446440000000000644ff3443344000000000000644ff344334400000000000000000000000000000000000000070070077777770
00000000033b30000000000033630000000000060000033b30000000000000060000033b30000000000000000000000000000000000000000000000070070070
00000000fb44b3000000000fb44b30000000000000ffbb44b3f000000000000000ffbb44b3f00000000000000000000000000000000000000000000077707770
0000000fffbb33f00000000ffbb33f000000000000fff3bb3fff00000000000000fff3bb3fff0000000000000000000000000000000000000070070007777700
0000000ff03b0ff00000000ff3b0ff0000000000000ff03b00fff00000000000000ff03b00fff000000000000000000000000000000000000700007007070700
00000044400004400000000440004440000000000044400000044000000000000044400000044000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000660000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000066600000000000000000000000000000000000000000000000000000000000000000
08888800000000000000000000000000000000000000000000000000006660000000000000000000000000000000000000000000000000000000000000000000
00088888000000000000000000000000000000000000000000000000666000000000000000000000000000000000000000000000000000000000000000000000
00008988800000000000000088888800000000000000000000000006760000000000000060000000000000000000000000000000000000000000000000000000
00000899888000000000008888888000000000000000000000000067600000000000006600000000000000000000000000000000000000000000000000000000
00000899988800000000088889880000000000000000000000000676000000000000066000000000000000000000000000000000000000000000000000000000
00008997998880000000888899800000000000000000000000006760000000000000676000000000000006000000000000000000000000000000000000000000
00008997799880000008888999800000000088888800000000067760000000000006760000000000000060000000000000000000000000000000000000000000
00088997799988000008889979980000000000888880000000677600000000000067600000000000000660000000000000000000000000000000000000000000
00889977799998000088889779988800000000089888800007776000000000000677600000000000006700000000000000000000000000000000000000000000
08899777779998000088899779998880000000889998880077776000000000000777600000000000077600000000000000000000000000000000000000000000
08997777777998000088997777999880000088899799888077770000000000000776000000000000077000000000000000000000000000000000000000000000
00997777777998000089977777999880000888997779988077770000000000000770000000000000000000000000000000000000000000000000000000000000
00099777777990000089977777998880000889977779988077700000000000000000000000000000000000000000000000000000000000000000000000000000
00099777779900000008997779998000000889977779988007000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000ddd0000000deed00000dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000ddddeeed000000deed0000deed000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000ddd0000000000deedee7eed000000dd00000deed000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000deeed00000000deeedeee7ed00000000ddd000dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000deeed00000000de7eedeeeed0000000de7ed00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000ee7eed0000000de7eeeeded0000000deeeeed0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000edee7edd000000deeeedeeddd000000deededed000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000de7deeded00000dedeede7edeed00000de7edeed000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000deeee7eed00000deeddeeede7ed000000deede7d000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000dddeeeed00000de7eedede7eed000dd00dd0dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddd0000000deeededeeed000deed000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000dddd00ddd0000deed00000deed0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000dd000000deed0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000088800000d66000f0d660f00067700000888800000000000008880000
00000000000000000000000000000000000000000000000000000000000000000000000802880000ddd6000ffd6f000066670008882000000000000082008000
00000000000000000000000000000000000000000000000000000000000000000a00000028828000ddd6008ddddd0000666700b8888800000000000088800000
0000000000000000000000000000000000000000000000000000000000000000aaa000888888828066d00088d7570000446000bb87370000000000dd8ddd0000
00000000000000000000000000000000000000000000000000000000000000000a40000cc86d6c00006dd00222880550004bb00333bb033000000001d7170000
00000000000000000000000000000000000000000000000000000000000000000004cc82dddcc0dd0005dd65828805500003bb42b3bb033000000000d1ddd000
00000000000000000000000000000000000000000000000000000000000000000000d8882cdcc28d00056d665555d00000034b4422224000000000087dd10d00
00000000000000000000000000000000000000000000000000000000000000000000d4288222288000000656666d8200000004244444b300000000dd17dd0000
00000000000000000000000000000000000000000000000000000000000000000000004288888cd0000000055558880000000002222bbb000000000017770000
0000000000000000000000000000000000000000000000000000000000000000000000004444ccc0000000666558820000000044422bb3000000000d00770700
0000000000000000000000000000000000000000000000000000000000000000000000088824ccd0000002dd60d2200000000344404330000000000000077000
0000000000000000000000000000000000000000000000000000000000000000000000d88808dd00000002220000000000000333000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000ddd0000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000555555000000000555555000000000055555500000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000005555555500000005555555500000000555555550000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000555555000000000555555000000000055555500000000000000000000
__gff__
0000000000000000000100000101010100000000000000000000000100000100000000000000000000000000000000000000010000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000002425000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09090909090909091b091b091b091b09091b0000003435000028000028000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b0909091b091b090909091b091b091b09000000000000000000000000280009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09091b0e0e0e0e1b1b091b0909091b0000000028000000000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
091b091b1e1e1e0e0e09091b091b000000000000000000002800000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b09090e1e1e1e1e0d0e09091b00000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b09091b1e1e1e1e1d1e091b0000000028000000000000000000002800000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
091b1b0b1b0c1b1b0b1b09090000000000002800002800000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b0b0b0b0b1c09090b091b090000002800000000000000000028000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090b091b0909091b0b1b09093838383838383800000000000000000000280009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b0b090c091b090b0b09091b0000000000000038000000000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090b091c0b0b0b0b091b09002800003326272800380028000000280000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090b1b091b09090b090900000000330a36370000380000000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090b0909090b1b0b0b0b00280000191a33333300382800000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b0b1b1b090b091b091b00000000000000000000380000002800000000280009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090b09090b0b0909090909000000000000000038000000000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090b091b0b090c1b1b091b090028000000283800000000000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b0b0b0b0b091c09090909003838383838380000280000000028000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
091b090c0b0b0b1b090000000000000000000000000000000000000000202132000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909091c0b0909090920220000002800000028000000000000000020210f0f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
091b091b091b091b200f0f22000000000000000000000000200e0e0f320f320f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09090909091b09200f320f0f22000000000000000000000e0e1e1e0e0e0f0f32000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b091b09090920320f0f0f321f220000202200000000201e1e1e0d1e1e320f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b09091b20210f231f1f1f1f1f0f2121320f212121210f320f1e1d1e320f320f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909200f0f0f320f0f0f1f320f0f0f0f0f320f321f32320f0f1b001b0f0f0f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
091b3032230f0f0f0f0f1f0f0f3223320f0f320f1f1f1f0f322121210f0f320f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09200f0f1f1f23320f0f230f0f0f1f0f0f0f0f0f0f3223320f3223320f0f0f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b300f231f0f320f32320f0f321f1f1f23320f320f0f0f0f0f0f0f0f0f320f32000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2032320f0f0f231f1f2332231f1f0f0f320f0f0f0f320f0f320f0f0f0f0f0f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
300f0f320f0f320f320f0f0f320f320f0f32320f0f0f0f0f320f0f320f320f32000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
